%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% load data, partition sample
load newqdata;

%  dependent variables
y = [y3,.01*log(ur./(1-ur)),dp];
clear dp ur y3 newqdata date
[T,N] = size(y); % N = number of equations
L = 2; % VAR lag order

% initial estimates through T0
T0 = 4*11-L-1; %end of 1958
% adaptive estimation through T1
T1 = T-L; % end of 2000

% lagged dependent variables: X1 = [y(t-1) y(t-1) ... y(t-L)]
X1 = zeros(T-L,1+(N*L));
X1(1:T-L,1) = ones(T-L,1);
for i = 1:L,
   X1(1:T-L,2+(N*(i-1)):1+(i*N)) = y(1+L-i:T-i,:);
end
Y = y(1+L:T,:)';
X = xmat(X1',X1',X1'); % X is a tensor; identical rhs variables in this case

% partitioning the data
Y0 = Y(:,1:T0);
YS = Y(:,1+T0:T1);
X0 = X(:,:,1:T0);
XS = X(:,:,1+T0:T1);
XS1 = X1(1+T0:T1,:);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% an informative prior: SUR estimates through T0
[SI,PI,RI] = sur(Y0,X0,T0);
df = N*(1+N*L) + 1; % prior degrees of freedom
DF = df + T1 - T0; % posterior degrees of freedom
Q0 = (3.5e-04)*PI; % prior covariance matrix for state innovations
TQ0 = df*Q0; % prior scaling matrix
TQ = TQ0; % initialize posterior scaling matrix

% implied prior mean and AR roots
S = [eye(N*(L-1)),zeros(N*(L-1),N)];
A = [SI(2:1+N*L,1)'; SI(2+(1+N*L):2*(1+N*L),1)'; SI(2+2*(1+N*L):3*(1+N*L),1)';S];
rr = eig(A);
M = inv(eye(N*L) - A)*[SI(1,1); SI(2+N*L,1); SI(3+2*N*L,1); zeros(N*(L-1),1)];
mm = M(1:3,1);
'prior mean'; mm
'prior AR roots'; rr
abs(rr)
clear M mm rr

% clear initial sample
clear y Y X Y0 X0 X01 T0 T1
[T,N] = size(YS');

% priors for SVOL parameters
% alpha, delta (normal) (same for all stochastic volatilities) (not needed for random walk spec)
b0 = [0,1]';
k = size(b0,1);
Sb0 = 10000*eye(k,k);
b = zeros(2,N); % alpha, delta in log volatility regression

% priors for sv (inverse gamma) (standard dev for volatility innovation)
sv0 = .01;
v0 = 1;
d0 = sv0^2;
eh = zeros(T,N); % volatility innovations

% priors for log h0 (normal); ballpark numbers
ss0 = 10;
mu0 = log(diag(RI));

% prior for correlation parameters for stochastic volatilities (normal)
ch0 = zeros(N*(N-1)/2,1);
ch = ch0;
ssc0 = 10000*eye(N*(N-1)/2,N*(N-1)/2);
CF = chofac(N,ch0);
